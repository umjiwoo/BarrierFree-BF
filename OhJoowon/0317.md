## 0317

-Erd 설계 및 API 명세서 완료 

create schema blindFin;
use blindFin;
CREATE TABLE `users` (
    `userId` INT NOT NULL AUTO_INCREMENT,
    `id` VARCHAR(50) NOT NULL,
    `password` VARCHAR(255) NOT NULL,
    `userName` VARCHAR(10) NOT NULL,
    `birthDate` DATE NOT NULL,
    `phoneNumber` CHAR(11) NOT NULL UNIQUE, 
    `joinedDate` DATETIME NOT NULL,
    PRIMARY KEY (`userId`)
);

CREATE TABLE `TransactionHistory` (
    `recentTransactionId` INT NOT NULL AUTO_INCREMENT,
    `userId` INT NOT NULL,
    `transactionAccount` VARCHAR(32) NOT NULL,
    `transactionBankCode` ENUM('001', '002', '003', '004') NOT NULL, -- 은행 코드 ENUM 값 추가 필요
    `transactionName` VARCHAR(32) NOT NULL DEFAULT '예금주 이름',
    `lastTransaction` DATETIME NOT NULL,
    PRIMARY KEY (`recentTransactionId`),
    FOREIGN KEY (`userId`) REFERENCES `users`(`userId`) ON DELETE CASCADE
);

CREATE TABLE `Account` (
    `accountId` INT NOT NULL AUTO_INCREMENT,
    `userId` INT NOT NULL,
    `account_no` VARCHAR(255) NOT NULL UNIQUE,
    `username` VARCHAR(30) NOT NULL,
    `account_balance` BIGINT NOT NULL DEFAULT 0,
    `daily_transfer_limit` INT NOT NULL DEFAULT 10000000,
    `one_time_transfer_limit` INT NOT NULL DEFAULT 5000000,
    `account_password` VARCHAR(30) NOT NULL,
    `created_at` DATETIME NOT NULL,
    `failed_attempts` INT NULL DEFAULT 0,
    `is_account_locked` BOOLEAN NOT NULL DEFAULT FALSE,
    PRIMARY KEY (`accountId`),
    FOREIGN KEY (`userId`) REFERENCES `users`(`userId`) ON DELETE CASCADE
);

CREATE TABLE `AccountTransaction` (
    `transactionId` INT NOT NULL AUTO_INCREMENT,
    `accountId` INT NOT NULL,
    `userId` INT NOT NULL,
    `transactionType` ENUM('DEPOSIT', 'WITHDRAWAL', 'TRANSFER') NOT NULL, -- ENUM 값 추가
    `transactionName` VARCHAR(32) NOT NULL,
    `transactionAmount` INT NOT NULL,
    `transactionBalance` INT NOT NULL,
    `transactionDate` DATETIME NOT NULL,
    `transactionAccount` VARCHAR(32) NOT NULL,
    `transactionBankCode` ENUM('001', '002', '003', '004') NOT NULL, -- ENUM 값 추가 필요
    PRIMARY KEY (`transactionId`),
    FOREIGN KEY (`accountId`) REFERENCES `Account`(`accountId`) ON DELETE CASCADE,
    FOREIGN KEY (`userId`) REFERENCES `users`(`userId`) ON DELETE CASCADE
);

CREATE TABLE `TransactionLog` (
    `transactionLogId` INT NOT NULL AUTO_INCREMENT,
    `transactionId` INT NOT NULL,
    `accountId` INT NOT NULL,
    `userId` INT NOT NULL,
    `transactionState` ENUM('PENDING', 'COMPLETED', 'FAILED', 'CANCELED') NOT NULL, -- ENUM 값 추가
    PRIMARY KEY (`transactionLogId`),
    FOREIGN KEY (`transactionId`) REFERENCES `AccountTransaction`(`transactionId`) ON DELETE CASCADE,
    FOREIGN KEY (`accountId`) REFERENCES `Account`(`accountId`) ON DELETE CASCADE,
    FOREIGN KEY (`userId`) REFERENCES `users`(`userId`) ON DELETE CASCADE
);

